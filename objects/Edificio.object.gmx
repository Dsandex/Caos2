<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Local variables.
down_speed = .5; // The speed of the destruction.
is_ready = false; // Fisures has covered all the building.
escombros_id = noone;
yy = sprite_height;
lt = noone; // Letrero.
shake = noone;
color = c_white;
yy2 = y;

// Damage variables.
building_life = irandom_range(15, 25);
damage_grid = ds_grid_create(building_life, 3);
progress_time = 15;
execute_alarms = true;

// Fill the grid.
for(var i = 0; i &lt; ds_grid_width(damage_grid); i++){
    for(var j = 0; j &lt; ds_grid_height(damage_grid); j++){
        ds_grid_add(damage_grid, i, j, "");
    }
}

// Fisures variables.
/*max_fisures_array = ds_list_create();
max_fisures = floor(sprite_get_height(spr_edificios)/sprite_get_height(spr_fisures));
for(var i = 0; i &lt; max_fisures; i++){
    ds_list_add(max_fisures_array, false);
}

// Create enemies.
//Create_Enemies(num_level);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Free memory.
ds_grid_destroy(damage_grid);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Destroy instances.
with escombros_id instance_destroy();
instance_destroy();
with shake instance_destroy();
audio_stop_sound(sn_edificio_collapse);
if(instance_exists(Screen_Shake)) with Screen_Shake instance_destroy();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Create fisure.
/*for(var i = 0; i &lt; max_fisures; i++){
    var var_pos = ds_list_find_value(max_fisures_array, i);
    if(!var_pos){
        ds_list_replace(max_fisures_array, i, true); 
        alarm[0] = progress_time;
        break;
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>Edificio</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Check conditions to collapse the building.
if(building_life &lt;= 0 and execute_alarms){

     with(Player){
         climb = false; 
         climbed_building = noone;
         vsp = -jumpspeed;
         Jump_Hspeed();
         eating = false;
         sprite_index = asset_get_index("spr_player_jump_" + humor + "_idle");
         image_index = choose(0,1,2);
     }
     
     is_ready = true;
     shake = instance_create(0,0, Screen_Shake);
     execute_alarms = false;
     Play_Track("collapse_building");
}

// If is ready, building collapse.
if(is_ready){

    // Destroy the advertising if defined.
    if(lt != noone) with lt instance_destroy();
    if(!instance_exists(Screen_Shake)) instance_create(0,0,Screen_Shake);
    
    // Destroy the building.
    if(y + yy &gt; y){
        //show_debug_message(down_speed);
        yy -= down_speed;
        yy2 += down_speed;
        if(escombros_id != noone) exit;
        escombros_id = instance_create(x + sprite_width/2, y - sprite_get_height(spr_collapse)/2, Collapse);
    }else{
        
    
        alarm[1] = 40;
        is_ready = false;
        var random_num = choose(2,3,4);
        for(var i = 0; i &lt; random_num; i++){
            instance_create(
                irandom_range(x + 10, x + sprite_width - 10), 
                375, 
                Child_Run
            );
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Draw the building.

    // Draw building.
    draw_sprite_part_ext(
        sprite_index, 
        0, 
        0, 
        0, 
        sprite_width, 
        yy, // sprite_height
        x,
        y - yy, // y position.
        1,
        1,
        color, 
        1
    );
    
    // Draw damage.
    for(var i = 0; i &lt; ds_grid_width(damage_grid); i++){
         
        //show_debug_message(ds_grid_get(damage_grid, i, 2));
        if(ds_grid_get(damage_grid, i, 2) == "") break ;
    
        var height = sprite_get_height(spr_building_damage);
    
        var xxd = ds_grid_get(damage_grid, i, 0);
        var yyd = ds_grid_get(damage_grid, i, 1);
        var index = ds_grid_get(damage_grid, i, 2);
        
        draw_sprite_part_ext(
            spr_building_damage, 
            index,
            0,
            0,
            sprite_get_width(spr_building_damage),
            height, 
            xxd, 
            yy2 - yyd, 
            1, 
            1, 
            c_white,
            1
        );
        
    }

</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
